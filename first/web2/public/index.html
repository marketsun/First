<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>구글&네이버 뉴스 크롤러</title>
    <link rel="stylesheet" href="/static/css/style-toss.css?v=20250108-selection-btn">
    <script>console.log('[테스트] HTML 버전: 20250104 - 캐시 무효화');</script>
</head>
<body>
    <!-- 토스트 알림 -->
    <div id="toast-notification" class="toast-notification">
        <span id="toast-message">전송 완료</span>
    </div>

    <div class="container">
        <!-- 페이지 최상단 영역 -->
        <div class="top-section">
            <header class="centered-header">
                <h1>구글&네이버 뉴스 크롤러 <span class="version-tag">{{ version }}</span></h1>
            </header>
        </div>

        <!-- 로딩 프로그레스바 -->
        <div id="loading-progress" class="loading-progress" style="display: none;">
            <div class="loading-progress-bar">
                <div class="loading-progress-fill"></div>
            </div>
            <div class="loading-progress-text">뉴스를 검색하는 중입니다...</div>
        </div>

        <!-- 통합 툴바 -->
        <div class="toolbar">
            <!-- 검색 영역 -->
            <div class="toolbar-search">
                <div class="search-input-wrapper">
                    <input type="text" id="keyword-input-toolbar" placeholder="검색어를 입력해 주세요 (F2)">
                    <button id="history-toggle-btn" class="btn-history-toggle-simple" title="검색기록">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                            <path d="M19 9l-7 7-7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
                <button id="crawl-btn-toolbar" class="btn-search-toolbar-outside">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                        <path d="M21 21L16.65 16.65M19 11C19 15.4183 15.4183 19 11 19C6.58172 19 3 15.4183 3 11C3 6.58172 6.58172 3 11 3C15.4183 3 19 6.58172 19 11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>

                <!-- 뉴스클리핑 버튼 -->
                <button id="clipping-page-btn" class="btn-clipping-page" title="뉴스클리핑 예약발송" onclick="console.log('클리핑 버튼 클릭됨'); showClippingPage();">
                    <span style="font-size: 16px;">📰</span>
                </button>

                <!-- 검색기록 드롭다운 -->
                <div id="history-dropdown" class="history-dropdown" style="display: none;">
                    <div class="history-dropdown-header">
                        <span>최근 검색어</span>
                        <button id="clear-history-btn" class="btn-clear-history">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" style="vertical-align: middle; margin-right: 4px;">
                                <path d="M3 6h18M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2m3 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6h14z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            전체삭제
                        </button>
                    </div>
                    <div id="history-list" class="history-dropdown-list">
                        <!-- 검색기록 항목이 동적으로 추가됨 -->
                    </div>
                    <div id="history-empty" class="history-dropdown-empty" style="display: none;">
                        검색 기록이 없습니다
                    </div>
                </div>
            </div>
        </div>

        <!-- 메인 콘텐츠 영역 (2분할) -->
        <div class="main-content-split" style="margin-top: 0; padding-top: 0;">
            <!-- 왼쪽: 검색 결과 -->
            <div class="result-container">
                <div class="container-header">
                    <div class="header-left">
                        <h3>검색 결과 (<span id="google-count">0</span>/<span id="naver-count">0</span>)</h3>
                        <input type="text" id="article-filter-input" class="article-filter-input" placeholder="기사필터">
                    </div>
                    <div class="header-filters">
                        <select id="date-filter">
                            <option value="all">전체 기간</option>
                            <option value="today">오늘</option>
                            <option value="week">최근 7일</option>
                            <option value="month">최근 30일</option>
                        </select>
                        <select id="sort-filter">
                            <option value="desc">최신순</option>
                            <option value="asc">오래된순</option>
                        </select>
                    </div>
                </div>

                <!-- 검색 결과 2열 분할 -->
                <div class="search-results-split">
                    <!-- 구글 뉴스 -->
                    <div class="news-column">
                        <div class="table-wrapper">
                            <table class="news-table" id="google-news-table">
                                <thead>
                                    <tr>
                                        <th>시간</th>
                                        <th>출처</th>
                                        <th>기사 제목</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="google-news-table-body">
                                    <!-- 구글 뉴스 목록 -->
                                </tbody>
                            </table>
                            <div id="google-empty-state" class="empty-state">
                                <p>구글</p>
                            </div>
                            <div id="google-loading-state" class="loading-state" style="display: none;">
                                <div class="spinner"></div>
                                <p>기사를 가져오는 중입니다...</p>
                            </div>
                        </div>
                    </div>

                    <!-- 네이버 뉴스 -->
                    <div class="news-column">
                        <div class="table-wrapper">
                            <table class="news-table" id="naver-news-table">
                                <thead>
                                    <tr>
                                        <th>시간</th>
                                        <th>출처</th>
                                        <th>기사 제목</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="naver-news-table-body">
                                    <!-- 네이버 뉴스 목록 -->
                                </tbody>
                            </table>
                            <div id="naver-empty-state" class="empty-state">
                                <p>네이버</p>
                            </div>
                            <div id="naver-loading-state" class="loading-state" style="display: none;">
                                <div class="spinner"></div>
                                <p>기사를 가져오는 중입니다...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 오른쪽: 선택한 기사 -->
            <div class="selection-container">
                <div class="container-header">
                    <h3>선택한 기사 (<span id="selection-count">0</span>)</h3>
                    <div class="header-actions">
                        <button id="copy-selection-btn" class="btn-header-primary">전체 복사</button>
                        <span class="header-divider"></span>
                        <button id="save-articles-btn" class="btn-header">저장</button>
                        <button id="saved-list-btn" class="btn-header">저장목록</button>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table class="news-table" id="selection-table">
                        <thead>
                            <tr>
                                <th style="width: 75px;">시간</th>
                                <th style="width: 70px;">출처</th>
                                <th>기사 제목</th>
                                <th style="width: 40px;">
                                    <button id="clear-all-selection-btn" class="btn-clear-all-selection" style="font-size: 11px; padding: 4px 6px;">X</button>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="selection-table-body">
                            <!-- 선택한 기사 목록이 동적으로 추가됨 -->
                        </tbody>
                    </table>
                    <div id="selection-empty" class="empty-state">
                        <p>좌측 리스트에서 기사를 클릭하여 선택하세요</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 로그 로그 버튼 -->
    <button id="log-toggle-btn" class="log-floating-btn" title="실시간 로그">로그</button>

    <!-- 로그 로그 패널 -->
    <div id="log-floating-panel" class="log-floating-panel" style="display: none;">
        <div class="log-floating-header">
            <h4>실시간 로그</h4>
            <div class="log-floating-actions">
                <button id="clear-log-btn-float" class="btn-log-small">지우기</button>
                <button id="close-log-btn" class="btn-close-log">닫기</button>
            </div>
        </div>
        <div id="log-container" class="log-container">
            <div class="log-item info">시스템 준비 완료. 뉴스 크롤링을 시작하세요.</div>
        </div>
        <div class="log-floating-footer">
            <div class="log-status">
                <span id="log-status">0/500 줄</span>
            </div>
            <div class="log-copy-options">
                <div class="log-copy-input-group">
                    <label>최근</label>
                    <input type="number" id="custom-log-lines" value="200" min="1" max="500" style="width: 60px; padding: 4px; border: 1px solid #ddd; border-radius: 4px;">
                    <label>줄</label>
                    <button id="copy-recent-log-btn" class="btn-log-small" onclick="console.log('[HTML] 복사 버튼 클릭됨'); copyRecentLogsFromInput()">복사</button>
                </div>
                <button id="copy-all-log-btn" class="btn-log-small" onclick="console.log('[HTML] 전체 복사 버튼 클릭됨'); copyAllLogs()">전체 복사</button>
                <button id="test-copy-btn" class="btn-log-small" style="background: #ff6b6b; color: white; margin-top: 8px;" onclick="testCopyFunction()">🧪 테스트 복사</button>
            </div>
        </div>
    </div>

    <!-- 저장 목록 플로팅 패널 -->
    <div id="saved-list-modal-overlay" class="selection-modal-overlay" style="display: none;"></div>
    <div id="saved-list-panel" class="saved-list-panel-new" style="display: none;">
        <div class="saved-list-header">
            <h4>저장된 기사 목록</h4>
            <button id="close-saved-list-panel-btn" class="btn-close-panel">✕</button>
        </div>
        <div id="saved-list-container" class="saved-list-container-new">
            <!-- 저장된 파일 목록이 동적으로 표시됨 -->
        </div>
        <div id="saved-list-empty" class="saved-list-empty" style="display: none;">
            저장된 목록이 없습니다
        </div>
        <div class="saved-list-footer">
            <button id="delete-all-saved-btn" class="btn-delete-all-saved">전체 삭제</button>
        </div>
    </div>

    <!-- ===== 뉴스클리핑 페이지 섹션 ===== -->
    <div id="clipping-page" class="page-section">
        <div class="container">
            <!-- 뉴스클리핑 헤더 -->
            <div class="top-section">
                <header class="centered-header">
                    <h1>📰 뉴스클리핑 예약발송</h1>
                    <button id="back-to-crawler-btn" class="btn-back-to-crawler">뉴스 크롤러로 돌아가기</button>
                </header>
            </div>

            <!-- 뉴스클리핑 콘텐츠 -->
            <div class="clipping-container">
                <!-- 헤더 -->
                <div class="clipping-header">
                    <div>
                        <h2>자동 뉴스 클리핑</h2>
                        <p>설정 시간에 따라 검색어의 뉴스클리핑을 자동으로 Slack으로 전송합니다</p>
                    </div>
                    <button id="create-clipping-btn" class="btn-create-clipping">
                        <span>➕</span> 새로 생성
                    </button>
                </div>

                <!-- 뉴스클리핑 목록 -->
                <div id="clipping-list-container" class="clipping-list">
                    <div class="clipping-empty">
                        <div class="empty-icon">📋</div>
                        <h3>생성된 클리핑이 없습니다</h3>
                        <p>아래 버튼으로 뉴스클리핑을 만들어 자동 전송을 시작하세요</p>
                        <button id="create-clipping-empty-btn" class="btn-create-empty">
                            <span>➕</span> 새로 생성
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== 뉴스클리핑 세부 설정 모달 ===== -->
    <div id="clipping-detail-modal-overlay" class="modal-overlay"></div>
    <div id="clipping-detail-modal" class="clipping-detail-modal">
        <div class="clipping-detail-header">
            <h2>⚙️ 뉴스클리핑 설정</h2>
            <button id="close-clipping-detail-btn" class="btn-close-detail">✕</button>
        </div>
        <div class="clipping-detail-content">
            <div class="form-grid">
                <!-- 기본 설정 -->
                <div class="section-title">📌 기본 설정</div>
                <div class="form-group span-2">
                    <label for="clipping-name">클리핑 제목</label>
                    <input type="text" id="clipping-name" placeholder="예: 아이보스 마케팅 뉴스클리핑">
                </div>
                <div class="form-group">
                    <label for="repeat-type">반복 주기</label>
                    <select id="repeat-type">
                        <option value="daily">매일</option>
                        <option value="weekly">주 1회</option>
                        <option value="monthly">월 1회</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="send-time">전송 시간</label>
                    <input type="time" id="send-time" value="09:00">
                </div>
                <div class="form-group">
                    <label for="max-articles">최대 기사 수</label>
                    <select id="max-articles">
                        <option value="5">5개</option>
                        <option value="10" selected>10개</option>
                        <option value="15">15개</option>
                        <option value="20">20개</option>
                    </select>
                </div>

                <!-- 검색어 설정 -->
                <div class="section-title">🔍 검색어</div>
                <div class="form-group span-full">
                    <label>검색할 키워드</label>
                    <div class="keywords-input" id="keywords-input">
                        <input type="text" id="keyword-input" placeholder="검색어를 입력하고 Enter로 추가">
                    </div>
                </div>

                <!-- 기사 옵션 -->
                <div class="section-title">📄 기사 옵션</div>
                <div class="form-group span-2">
                    <div class="checkbox-group">
                        <input type="checkbox" id="include-summary" checked>
                        <label for="include-summary">요약 포함</label>
                    </div>
                    <div class="checkbox-group" style="margin-top: 8px;">
                        <input type="checkbox" id="include-links" checked>
                        <label for="include-links">링크 포함</label>
                    </div>
                </div>

                <!-- Slack 설정 -->
                <div class="section-title">🔗 Slack 설정</div>
                <div class="form-group span-6">
                    <label for="slack-webhook-url">Slack 웹훅 URL</label>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <input type="text" id="slack-webhook-url" placeholder="Slack 웹훅 URL을 입력하세요" style="flex: 1;">
                        <span id="webhook-validation-message" class="webhook-message" style="min-width: 100px;"></span>
                    </div>
                    <a href="https://api.slack.com/apps" target="_blank" style="color: #0066cc; font-size: 12px; margin-top: 5px; display: inline-block;">Slack API 설정</a>
                </div>

                <!-- 액션 버튼 -->
                <div class="action-bar">
                    <button id="cancel-clipping-btn" class="btn-cancel">취소</button>
                    <button id="save-clipping-btn" class="btn-save-detail">설정 저장</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/main.js?v=20250108-savetoast"></script>
</body>
</html>
